# RFM-анализ клиентской базы H&M

## Введение
В современных условиях рынка, ориентированного на потребителя, важность анализа поведения клиентов становится ключевой для успеха розничных компаний. Особенно это актуально для крупных ритейлеров, таких как H&M, где удержание клиентов и их лояльность напрямую влияют на экономические показатели компании. Проект посвящён анализу RFM (Recency, Frequency, Monetary), который позволяет оценить текущее положение компании на рынке и определить наиболее ценных для бизнеса клиентов.
## Как запустить проект
- Склонируйте репозиторий на свой локальный компьютер:
```sh
git clone https://github.com/your-username/your-repository.git
```
- Данные для анализа:
Данные слишком велики для хранения на GitHub. В проекте используются прямые ссылки на 3 файла с данными на мой Google Диск: ArticlesHM, CustomersHM и TransactionsHM.
- Откройте ноутбуки:
Откройте ноутбуки в папке /notebooks через Google Colab или Jupyter Notebook для просмотра и выполнения кода.
- Установите необходимые зависимости с помощью команды:
```sh
pip install -r requirements.txt
```
(Предполагается, что вы создали файл requirements.txt со списком всех необходимых библиотек).

**Пример кода для доступа к данным на Google Диске в Google Colab**
```python
from pydrive.auth import GoogleAuth
from pydrive.drive import GoogleDrive
from google.colab import auth
from oauth2client.client import GoogleCredentials
import pandas as pd

# Аутентификация и авторизация
auth.authenticate_user()
gauth = GoogleAuth()
gauth.credentials = GoogleCredentials.get_application_default()
drive = GoogleDrive(gauth)

# Загрузка файлов с Google Диска
file_ids = {
    'articles': '1H-g4oAbw1ZjYDOncx3xU3oro3tH3UIg6',
    'customers': '1KLM7Vum2O35MR17ULRLneM0uGVX61-VR',
    'transactions': '18ESMoz4VDe_ZCZzRPKKZS-UargXvrRdi'
}

for name, file_id in file_ids.items():
    downloaded = drive.CreateFile({'id': file_id})
    downloaded.GetContentFile(f'{name}.csv')
    print(f'{name}.csv downloaded')

# Чтение данных в DataFrame
df_articles = pd.read_csv('articles.csv')
df_customers = pd.read_csv('customers.csv')
df_transactions = pd.read_csv('transactions.csv')

# Отображение первых строк каждого DataFrame
print(df_articles.head())
print(df_customers.head())
print(df_transactions.head())
```
## Цели и задачи
### Цели
Основная цель данного проекта — разработать методику сегментации клиентов на основе RFM-анализа для оптимизации маркетинговых стратегий H&M. Это включает в себя:
- Идентификацию и анализ различных сегментов покупателей.
- Оценку эффективности текущих маркетинговых и продажных стратегий.
- Повышение уровня вовлеченности и удержания клиентов.
### Задачи
В данном проекте сосредоточены следующие ключевые задачи:
- **Реализация RFM-анализа:** Разработка и внедрение алгоритма для расчета показателей Recency, Frequency и Monetary каждого клиента. Алгоритм поможет идентифицировать наиболее ценных клиентов и понять динамику их покупок.
- **Сегментация клиентов:** Основываясь на RFM-показателях, клиенты будут классифицированы в различные группы. Это позволит разработать целевые маркетинговые стратегии, которые будут адаптированы к потребностям и поведению каждой группы.
- **Анализ результатов и формулировка рекомендаций:** Оценка эффективности сегментации и анализ поведения различных сегментов клиентов. На основе этих данных будут сформулированы предложения по улучшению маркетинговых и коммуникационных стратегий для увеличения вовлеченности и лояльности клиентов.

## Подробная методология
### Инструменты и библиотеки

В данном проекте использовались следующие инструменты и библиотеки:
- **Python:** Основной язык программирования, используемый для анализа данных и построения моделей.

- **Pandas:** Библиотека для обработки и анализа данных. Использовалась для работы с датафреймами.

- **NumPy:** Библиотека для работы с массивами и выполнения численных вычислений.

- **Seaborn:** Библиотека для визуализации данных, основанная на matplotlib. Использовалась для создания статистических графиков.

- **Matplotlib:** Основная библиотека для создания графиков и визуализации данных.
  
- **Squarify:** Библиотека для создания трематических диаграмм (treemaps).

- **textwrap:** Библиотека для оборачивания текста в строках, чтобы текст помещался в заданные границы.

- **Plotly:** Библиотека для интерактивной визуализации данных.

### Сбор и предобработка данных
**Источник данных:**
  Данные для этого проекта взяты c https://www.kaggle.com/competitions/h-and-m-personalized-fashion-recommendations
  
**Структура базы данных:**
  База данных представлена в виде трех файлов: ArticlesHM, CustomersHM и TransactionsHM. 
  **ArticlesHM** - это таблица, которая содержит все артикулы H&M, а именно **105 542 строк**, включая следующие колонки:
  - **article_id:** id товара, тип данных - int64
  - **prod_name:** название товара, тип данных - object
  - **product_type_name:** название типа товара, тип данных - object
  - **product_group_name:** название группы товара, тип данных - object
  - **graphical_appearance_name:** название рисунка товара, тип данных - object
  - **colour_group_name:** название группы цвета, тип данных - object
  - **index_name:** название раздела, тип данных - object
  - **index_group_name:** название группы разделов, тип данных - object
  - **section_name:** название секции, тип данных - object
  - **garment_group_name:** категория товара, тип данных - object
  - **detail_desc:** детали, тип данных - object

**CustomersHM** - это таблица, которая содержит информацию о клиентах H&M, а именно **1 371 979 строк**, включая следующие колонки:
  - **customer_id:** id клиента, тип данных - object
  - **Active:** , тип данных - float64
  - **club_member_status :** статус в клубе, тип данных - object
  - **fashion_news_frequency:** подписка на новости (частота), тип данных - object
  - **age:** возраст клиента, тип данных - float64
  - **postal_code:** почтовый индекс, тип данных - object

**TransactionsHM** - это таблица, которая содержит информацию о продажах H&M, а именно **31 788 323 строк**, включая следующие колонки:
  - **t_dat:** дата продажи, тип данных - object
  - **customer_id:** id клиента, тип данных - object
  - **article_id:** id товара, тип данных - int64
  - **price :** цена товара, тип данных - float64
  - **sales_channel_id:** канал продажи, тип данных - int64
Эти файлы были предварительно очищены от ошибок и пропусков, а также агрегированы для анализа в предыдущем проекте. В данном проекте фокус смещен на разработку и реализацию RFM-анализа.

### Реализация RFM-анализа

RFM-анализ — это маркетинговый инструмент, используемый для сегментации клиентов и определения групп пользователей на основе их прошлой активности покупок. Этот метод анализа основан на трех основных параметрах, отсюда и название RFM, что означает:
- **Recency (Недавность)** — как давно клиент совершил последнюю покупку. Недавние покупатели с большей вероятностью откликнутся на новые предложения. Важно понимать, как долго клиенты остаются активными.
- **Frequency (Частота)** — насколько часто клиент совершает покупки за определенный период. Клиенты, которые чаще всего совершают покупки, скорее всего, более лояльны и ценны для компании.
- **Monetary (Денежная стоимость)** — общая сумма денег, потраченная клиентом. Этот параметр помогает определить, какие клиенты приносят наибольшую выручку.

Использование RFM-анализа позволяет компаниям:
- Увеличить вероятность отклика на маркетинговые акции, направляя предложения наиболее перспективным клиентам.
- Улучшить персонализацию предложений, создавая предложения, которые соответствуют конкретным потребностям разных сегментов.
- Повысить общую эффективность маркетинговых усилий, оптимизируя ресурсы и сосредотачивая внимание на наиболее прибыльных клиентах.

#### Сегментация клиентов по давности покупок

В рамках анализа RFM, одним из ключевых аспектов является оценка давности последней покупки клиента (Recency). Для этого были использованы данные о покупках с 20 сентября 2018 года по 22 сентября 2020 года. Для каждого клиента было рассчитано количество дней с момента его последней покупки до последней даты в данных (22.09.2020).

```python
Frühestes Datum: 2018-09-20 00:00:00
Letztes Date: 2020-09-22 00:00:00
```

Данные были визуализированы с помощью гистограммы и боксплота, которые показывают распределение дней с последней покупки среди всех клиентов. Гистограмма демонстрирует, как часто клиенты возвращаются для повторных покупок, а боксплот предоставляет информацию о медианных значениях и распределении дней между покупками.

На гистограмме видно, что большинство покупок совершается в первые 100 дней после предыдущей покупки, после чего количество покупок с течением времени снижается. Боксплот показывает, что медианное значение составляет 151 день, что указывает на то, что половина всех клиентов совершает повторные покупки в течение примерно пяти месяцев после последней покупки.

![КоличествоДнейСПослПокупкиЯщикГистограмма](https://github.com/OlhaAD/RFM_HandM/blob/main/visualisations/TageSeitLetztenKaufHistAndBoxPlot.png)

Основываясь на гистограмме распределения дней с последней покупки, можно определить следующие группы для сегментации клиентов:
- **Очень активные клиенты:** Клиенты, совершившие покупку в последние 30 дней или меньше. 
- **Активные клиенты:** Клиенты, совершившие покупку от 31 до 100 дней.
- **Умеренно активные клиенты:** Клиенты, совершившие покупку от 101 до 365 дней.
- **Давно неактивные клиенты:** Клиенты, у которых последняя покупка была более года назад.
  
```python
def recency_score(rec):
  if rec > 365:
    return 4
  elif (rec > 100) and (rec <= 365):
    return 3
  elif (rec > 30) and (rec <= 100):
    return 2
  else:
    return 1
df_rfm['recency']= df_rfm['days_since_last_purchase'].apply(recency_score)
```
**Визуализация распределения клиентов по группам давности покупок**
График демонстрирует, что наибольшее количество клиентов принадлежит к группе 3, что указывает на то, что значительная часть клиентской базы совершала покупки в течение последнего года. Также важно отметить, что даже в группе 4, где клиенты считаются давно неактивными, сохраняется значительное количество клиентов, что может указывать на потенциал для повторного привлечения этих клиентов через целенаправленные маркетинговые кампании.

![RecencyРаспределение](https://github.com/OlhaAD/RFM_HandM/blob/main/visualisations/RecencyGruppeHist.png)

#### Сегментация клиентов по частоте покупок
Анализ проведен на основе данных транзакций за последние два года. Гистограмма и боксплот демонстрируют распределение количества покупок на клиента. 

![КоличествоПродажНаОдногоКлиентаЯщикГистограмма](https://github.com/OlhaAD/RFM_HandM/blob/main/visualisations/AnzahlVerk%C3%A4ufeProKundeHistAndBoxPlot.png)

На основе этих данных клиенты были разделены на четыре группы:
- **Очень активные клиенты:** Совершили более 27 покупок за весь период. Эта группа приближается к верхнему квантилю, показывая высокую частоту покупок.
- **Активные клиенты:** Совершили от 10 до 26 покупок за два года. Эта группа находится между медианой и верхним квантилем, указывая на умеренно высокую активность.
- **Умеренно активные клиенты:** Совершили от 4 до 9 покупок. Диапазон этих клиентов лежит между первым квантилем и медианой, что отражает умеренную покупательскую активность.
- **Менее активные клиенты:** Совершили менее 3 покупок за период. Эти клиенты находятся ниже первого квантиля и демонстрируют низкую частоту покупок.

**Визуализация распределения клиентов по группам частоты покупок**

Данный график демонстрирует распределение клиентов H&M по четырем группам частоты покупок в рамках RFM-анализа. Группы определены на основе количества покупок, совершенных клиентами за анализируемый период:
- **Группа 1:** Клиенты с очень высокой частотой покупок.
- **Группа 2:** Клиенты с высокой частотой покупок.
- **Группа 3:** Клиенты со средней частотой покупок.
- **Группа 4:** Клиенты с низкой частотой покупок.

График показывает равномерное распределение клиентов по этим четырем группам, что подчеркивает разнообразие покупательской активности в клиентской базе H&M.

![FrequencyРаспределение](https://github.com/OlhaAD/RFM_HandM/blob/main/visualisations/FrequencyGruppeHist.png)

#### Сегментация клиентов по сумме покупок

Используемые гистограмма и боксплот иллюстрируют распределение общей суммы расходов клиентов. Данные визуализации позволяют наглядно увидеть, как распределены расходы среди разных групп клиентов, идентифицировать основные тенденции и аномалии в потребительском поведении.

![ОбщаяСуммаПродажНаОдногоКлиентаЯщикГистограмма](https://github.com/OlhaAD/RFM_HandM/blob/main/visualisations/EinkaufssummeProKundeHistAndBoxPlot.png)

На основе этих данных клиенты были разделены на следующие четыре группы:
- **Низкая сумма покупок:** Клиенты, чьи расходы находятся ниже первого квартиля (Q1, менее 0.09). Эти клиенты тратят значительно меньше по сравнению с остальными.
- **Средняя сумма покупок:** Основная группа покупателей, чьи расходы находятся между первым и третьим квартилями (Q1 и Q3), что соответствует сумме выше 0.09 до 0.7. Эти клиенты представляют собой стандартное потребительское поведение.
- **Высокая сумма покупок:** Клиенты, чьи траты превышают третий квартиль (Q3, 0.7), но не достигают уровня выбросов, с расходами до 1.5. Эти клиенты тратят больше среднего, и их покупательская активность может указывать на более высокую лояльность или наличие более высоких доходов.
- **Очень высокая сумма покупок:** Клиенты, чьи траты превышают верхние "усы" боксплота, что считается выбросами (более 1.5). Это наиболее ценные клиенты, которые тратят значительно больше всех остальных. Их покупательское поведение может быть связано с особыми случаями, например, покупками в рамках крупных событий или высоким уровнем личной лояльности к бренду.

**Визуализация распределения клиентов по группам суммы покупок**

На представленной гистограмме иллюстрируется распределение клиентов H&M по четырем группам, основанным на сумме покупок в рамках RFM-анализа. Группы определены следующим образом:
- **Группа 1:** Клиенты с наибольшими общими расходами.
- **Группа 2:** Клиенты со значительными расходами, но меньше, чем в первой группе.
- **Группа 3:** Клиенты с умеренными расходами, занимающие наибольшую долю на графике.
- **Группа 4:** Клиенты с наименьшими расходами, их количество заметно меньше по сравнению с остальными группами.

![MonetaryРаспределение](https://github.com/OlhaAD/RFM_HandM/blob/main/visualisations/MonetaryGruppeHist.png)

### Сегментация клиентов

Первичная сегментация клиентов представлена на следующей визуализации. На графике показано распределение клиентов по сегментам RFM на основе их поведения. Сегменты сортированы по количеству клиентов, что позволяет легко определить наиболее многочисленные группы.

![ПервичноеСегментирование](https://github.com/OlhaAD/RFM_HandM/blob/main/visualisations/Prim%C3%A4reRFMAufteilungPlot.png)

Стоит отметить, что у нас образовалось довольно много сегментов с малым количеством клиентов. Эти сегменты были объединены в общую категорию — Andere Gruppen. В дальнейшем будет проведено обобщение сегментов в более крупные группы, и все малочисленные сегменты также будут учтены и включены в соответствующие группы. Согласно визуализации, сегмент с наибольшим количеством клиентов — это сегмент 444. Это в основном потерянные мелкие клиенты, которые совершили свои последние покупки более года назад, не более трех покупок, и на небольшие суммы (менее 0,09).

**Комбинирование сегментов и создание обобщенных групп клиентов:**

В ходе обобщения образовалось следующие 10 групп:
1. **Уходящие мелкие клиенты:** Сегменты 444, 434, 443, 433, 424. Эти клиенты не совершали покупок более года и делали либо мало покупок, либо на небольшие суммы.

2. **Уходящие средние клиенты:** Сегменты 423, 442, 432, 422, 413. Эти клиенты не покупали более года, но раньше делали покупки на средние суммы (от 0.1 до 1.5).

3. **Уходящие VIP-клиенты:** Сегменты 421, 411, 431, 412. Эти клиенты либо совершили значительное количество покупок (более 28), как в сегменте 412, либо потратили значительные суммы (выше третьего квартиля), но не покупали более года. Эта группа требует особого внимания, так как они представляют высокую ценность для бизнеса.

4. **Спящие мелкие клиенты:** Сегменты: 344, 343, 334, 324, 333. Это клиенты, не совершавшие покупок более 100 дней, в основном с небольшими суммами покупок. Это клиенты с низкой активностью и низкой денежной стоимостью для бизнеса.

5. **Спящие средние клиенты:** Сегменты: 323, 322, 313, 332, 342. Клиенты, не совершавшие покупок более 100 дней, со средними суммами покупок. Эта группа включает клиентов с умеренной активностью и средней денежной стоимостью.

6. **Спящие VIP-клиенты:** Сегменты: 311, 331, 312, 321. Это клиенты, не совершавшие покупок более 100 дней, но характеризующиеся либо очень крупными суммами покупок, либо большим количеством покупок (более 28). Эти клиенты имеют высокую ценность для бизнеса, несмотря на их отсутствие активности в последнее время.

7. **Активные мелкие клиенты:** Сегменты: 244, 144, 234, 143, 134, 243, 124, 224, 233, 133. Клиенты, совершившие покупки в последние 100 дней, но на небольшие суммы.

8. **Средние постоянные клиенты:** Сегменты: 123, 113, 213, 223, 222, 232, 132. Клиенты, совершившие покупки в последние 100 дней, с суммами от 0.1 до 1.5.

9. **Крупные постоянные клиенты:** Сегменты: 212, 112, 122. Клиенты, совершившие покупки в последние 100 дней, основная масса из них сделали более 28 покупок, потратив от 0.7 до 1.5.

10. **VIP клиенты:** Сегменты: 111, 211, 121, 221, 131, 231 Описание: Клиенты, совершившие покупки в последние 100 дней на очень крупные суммы (более 1.5).

**Визуализация распределения клиентов по 10 консолидационным группам RFM**

Данная круговая диаграмма иллюстрирует распределение клиентов H&M по десяти объединенным RFM-группам, которые были сформированы на основе анализа Recency, Frequency и Monetary. Эти группы представляют различные уровни вовлеченности и активности клиентов, что позволяет компании эффективно сегментировать свою клиентскую базу и нацеливать маркетинговые стратегии на соответствующие сегменты.

![10ГруппRFM](https://github.com/OlhaAD/RFM_HandM/blob/main/visualisations/RFMGroupen.png)
